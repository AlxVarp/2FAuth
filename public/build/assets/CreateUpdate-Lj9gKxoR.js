import{Y as Ve,Z as De,r as f,l as h,m as n,d,e as s,g as ie,t as b,h as g,i as c,f as e,n as C,T as Q,k as V,G as B,j as i,U as Ce,F as ce,u as Pe,b as He,a as Ke,c as le,x as Ee,o as Ge,J as M,P as se,s as G,_ as Qe,C as ae,D as $e,w as Ie,L as Re,p as ze,S as je,H as A}from"./app-DivTFvlm.js";import{F as ne}from"./Form-CHg6aD9v.js";import{_ as re}from"./OtpDisplay--p_2JRo2.js";import{_ as We}from"./QrContentDisplay-BoBsX6kw.js";import{u as Je}from"./bus-BArM1eUg.js";import"./Spinner-D32cz8pt.js";/*! 2FAuth version 5.5.0 - Copyright (c) 2024 Bubka - https://github.com/Bubka/2FAuth */const Ye=["for"],Ze=["disabled","id","type","value","placeholder","maxlength","aria-describedby","aria-invalid","aria-errormessage"],Xe={key:0,class:"control"},eo=["title"],oo={class:"icon"},to={key:1,class:"control"},lo=["title"],so={class:"icon has-text-danger"},ao=["id","innerHTML"],Fe=Object.assign({inheritAttrs:!1},{__name:"FormLockField",props:{modelValue:String,modelModifiers:{default:()=>({})},isEditMode:{type:Boolean,default:!1},label:{type:String,default:""},fieldName:{type:String,default:"",required:!0},fieldError:[String],inputType:{type:String,default:"text"},placeholder:{type:String,default:""},help:{type:String,default:""},hasOffset:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!0},maxLength:{type:Number,default:null},idSuffix:{type:String,default:""},isLocked:Boolean},emits:["update:modelValue"],setup(u,{emit:R}){const p=u,{inputId:D}=Ve(p.inputType,p.fieldName+p.idSuffix),{valErrorId:w}=De(p.fieldName),U=Ve("legend",p.fieldName).inputId,E=f(p.isDisabled||p.isEditMode||p.isLocked),y=f(!1),o=f(0),T=R;function $(m){let v=m.target.value;p.modelModifiers.trimAll&&(v=v.replace(/\s+/g,"")),T("update:modelValue",v)}function S(m){let v=m.target.value;y.value=v.includes(" "),T("update:modelValue",v)}function z(m){y.value=m.target.value.includes(" "),o.value+=1}return(m,v)=>{const k=h("FontAwesomeIcon"),r=h("FieldError");return n(),d(ce,null,[s("label",{for:e(D),class:"label"},[ie(b(m.$t(u.label)),1),u.isLocked?(n(),g(k,{key:0,icon:["fas","lock"],class:"ml-2",size:"xs"})):c("",!0)],8,Ye),s("div",{class:C(["field has-addons mb-0",{"pt-3":u.hasOffset}])},[s("div",{class:C(["control",{"is-expanded":u.isExpanded}])},[(n(),d("input",Q({key:e(o),disabled:e(E),id:e(D),type:u.inputType,class:"input",value:u.modelValue,placeholder:u.placeholder},m.$attrs,{onInput:S,onChange:$,onBlur:z,maxlength:u.maxLength,"aria-describedby":u.help?e(U):void 0,"aria-invalid":u.fieldError!=null,"aria-errormessage":u.fieldError!=null?e(w):void 0}),null,16,Ze))],2),u.isEditMode?(n(),g(e(Ce),{key:0},{default:V(({mode:I})=>[e(E)?(n(),d("div",Xe,[s("button",{type:"button",class:C(["button field-lock",{"is-dark":I=="dark"}]),onClick:v[0]||(v[0]=B(F=>E.value=!1,["stop"])),title:m.$t("twofaccounts.forms.unlock.title")},[s("span",oo,[i(k,{icon:["fas","lock"]})])],10,eo)])):(n(),d("div",to,[s("button",{type:"button",class:C(["button field-unlock",{"is-dark":I=="dark"}]),onClick:v[1]||(v[1]=B(F=>E.value=!0,["stop"])),title:m.$t("twofaccounts.forms.lock.title")},[s("span",so,[i(k,{icon:["fas","lock-open"]})])],10,lo)]))]),_:1})):c("",!0)],2),e(y)?(n(),g(r,{key:0,error:m.$t("twofaccounts.forms.spaces_are_ignored"),field:"spaces",alertType:"is-warning"},null,8,["error"])):c("",!0),u.fieldError!=null?(n(),g(r,{key:1,error:u.fieldError,field:u.fieldName},null,8,["error","field"])):c("",!0),u.help?(n(),d("p",{key:2,id:e(U),class:"help",innerHTML:m.$t(u.help)},null,8,ao)):c("",!0)],64)}}}),no={class:"container preview has-text-centered"},ro={class:"columns is-mobile"},io={class:"column"},co={key:1,class:"add-icon-button"},uo={class:"columns is-mobile",role:"alert"},fo={key:0,class:"column"},po={class:"columns is-mobile"},mo={class:"column quickform-footer"},vo={class:"field is-grouped is-grouped-centered"},ho={class:"control"},go={key:0,class:"field is-grouped"},yo={class:"control"},_o=["title"],bo={class:"file-cta"},wo={class:"file-icon"},ko={class:"file-label"},Vo={for:"filUploadIcon",class:"label"},Eo={class:"field is-grouped"},$o={key:0,class:"control"},Io={class:"icon is-small"},Fo={class:"control is-flex"},Co={class:"file-cta"},To={class:"file-icon"},So={class:"file-label"},xo=["src","alt"],Lo=["aria-label"],Mo={class:"field"},Ao=["innerHTML"],Uo={key:3},Oo={key:0},Bo={class:"title is-4 mt-5 mb-2"},No={class:"help mb-4"},qo={class:"control"},Do={key:0,class:"control"},zo={__name:"CreateUpdate",props:{twofaccountId:[Number,String]},setup(u){const R=Re("2fauth"),p=ze(),D=Qe(),w=Pe(),U=He(),E=Je(),y=Ke(),o=le(new ne({service:"",account:"",otp_type:"",icon:"",group_id:w.preferences.defaultGroup==-1?w.preferences.activeGroup:w.preferences.defaultGroup,secret:"",algorithm:"",digits:null,counter:null,period:null,image:""})),T=le(new ne({qrcode:null})),$=le(new ne({icon:null})),S=f({otp_type:"",account:"",service:"",icon:""}),z=[{text:"TOTP",value:"totp"},{text:"HOTP",value:"hotp"},{text:"STEAM",value:"steamtotp"}],m=[{text:"6",value:6},{text:"7",value:7},{text:"8",value:8},{text:"9",value:9},{text:"10",value:10}],v=[{text:"sha1",value:"sha1"},{text:"sha256",value:"sha256"},{text:"sha512",value:"sha512"},{text:"md5",value:"md5"}],k=f(),r=f(""),I=f(!1),F=f(!1),N=f(!1),q=f(!1),x=f(!1),j=f(!1),W=f(null),J=f(null),P=f(null),Y=f(null),ue=f(null),de=f(null),fe=f(null),Z=u,_=Ee(()=>Z.twofaccountId!=null),pe=Ee(()=>je().items.map(t=>({text:t.id>0?t.name:"- "+A("groups.no_group")+" -",value:t.id})));Ge(()=>{D.name=="editAccount"?M.get(Z.twofaccountId).then(t=>{o.fill(t.data),o.group_id==null&&(o.group_id=0),o.setOriginal(),r.value=o.icon,q.value=!0}):E.decodedUri?(k.value=E.decodedUri,E.decodedUri=null,w.preferences.AutoSaveQrcodedAccount?M.storeFromUri(k.value).then(t=>{Le(t.data)}).catch(t=>{t.response.data.errors.uri&&(F.value=!0,q.value=!0)}):M.preview(k.value).then(t=>{o.fill(t.data),r.value=t.data.icon?t.data.icon:"",I.value=!0,se().then(()=>{P.value.show()})}).catch(t=>{t.response.data.errors.uri&&(F.value=!0,q.value=!0)})):q.value=!0}),G(r,t=>{I.value&&se().then(()=>{P.value.icon=t})}),G(x,t=>{var l,O;t==!1&&((l=Y.value)==null||l.clearOTP(),(O=P.value)==null||O.clearOTP())}),G(N,t=>{var l;t==!1&&((l=J.value)==null||l.clearOTP(),p.push({name:"accounts"}))}),G(()=>o.otp_type,(t,l)=>{t==="steamtotp"?(o.service="Steam",_e()):l==="steamtotp"&&(o.service="",L())});function Te(){_.value?Se():me()}async function me(){o.icon=r.value;const{data:t}=await o.post("/api/v1/twofaccounts");o.errors.any()===!1&&(U.items.push(t),y.success({text:A("twofaccounts.account_created")}),p.push({name:"accounts"}))}async function Se(){if(r.value!==o.icon){let l="";l=o.icon,o.icon=r.value,r.value=l,L()}const{data:t}=await o.put("/api/v1/twofaccounts/"+Z.twofaccountId);if(o.errors.any()===!1){const l=U.items.findIndex(O=>O.id===t.id);U.items.splice(l,1,t),y.success({text:A("twofaccounts.account_updated")}),p.push({name:"accounts"})}}function xe(){o.clear(),x.value=!0,Y.value.show()}function Le(t){S.value.otp_type=t.otp_type,S.value.service=t.service,S.value.account=t.account,S.value.icon=t.icon,se().then(()=>{N.value=!0,J.value.show(t.id)})}function ve(){o.hasChanged()||r.value!=o.icon?confirm(A("twofaccounts.confirm.cancel"))===!0&&((!_.value||r.value!=o.icon)&&L(),p.push({name:"accounts"})):p.push({name:"accounts"})}function he(){L(),$.icon=W.value.files[0],$.upload("/api/v1/icons",{returnError:!0}).then(t=>{r.value=t.data.filename,I.value&&(o.icon=r.value)}).catch(t=>{t.response.status!==422&&y.alert({text:t.response.data.message})})}function L(){_.value?r.value&&(r.value!==o.icon&&M.deleteIcon(r.value),r.value=""):r.value&&(M.deleteIcon(r.value),r.value="",I.value&&(o.icon=""))}function ge(t){o.counter=t.nextHotpCounter}function ye(t){o.errors.set(o.extractErrors(t))}function Me(){T.qrcode=de.value.files[0],T.upload("/api/v1/qrcode/decode",{returnError:!0}).then(t=>{k.value=t.data.data,M.preview(k.value,{returnError:!0}).then(l=>{o.fill(l.data),r.value=l.data.icon?l.data.icon:null}).catch(l=>{l.response.status===422?l.response.data.errors.uri?F.value=!0:y.alert({text:A(l.response.data.message)}):y.error(l)})}).catch(t=>{t.response.status!==422&&y.alert({text:t.response.data.message})})}function _e(){w.preferences.getOfficialIcons&&(j.value=!0,M.getLogo(o.service,{returnError:!0}).then(t=>{t.status===201?(L(),r.value=t.data.filename):y.warn({text:A("errors.no_logo_found_for_x",{service:be(o.service)})})}).catch(()=>{y.warn({text:A("errors.no_logo_found_for_x",{service:be(o.service)})})}).finally(()=>{j.value=!1}))}function be(t){return t.replace(/(<([^> ]+)>)/ig,"")}return(t,l)=>{const O=h("Modal"),X=h("FieldError"),H=h("FontAwesomeIcon"),ee=h("VueButton"),we=h("ButtonBackCloseCancel"),oe=h("FormField"),Ae=h("FormSelect"),te=h("FormToggle"),Ue=h("VueFooter"),ke=h("modal"),Oe=h("FormWrapper");return n(),g(e(Ce),null,{default:V(({mode:K})=>[s("div",null,[e(w).preferences.AutoSaveQrcodedAccount?(n(),g(O,{key:0,modelValue:e(N),"onUpdate:modelValue":l[1]||(l[1]=a=>ae(N)?N.value=a:null)},{default:V(()=>[i(re,Q({ref_key:"OtpDisplayForAutoSave",ref:J},e(S),{onPleaseCloseMe:l[0]||(l[0]=a=>e(p).push({name:"accounts"}))}),null,16)]),_:1},8,["modelValue"])):c("",!0),!e(_)&&e(I)?(n(),d("form",{key:1,onSubmit:B(me,["prevent"]),onKeydown:l[3]||(l[3]=a=>e(o).onKeydown(a))},[s("div",no,[s("div",ro,[s("div",io,[e($).errors.hasAny("icon")?(n(),g(X,{key:0,error:e($).errors.get("icon"),field:"icon",class:"help-for-file"},null,8,["error"])):c("",!0),e(r)?c("",!0):(n(),d("label",co,[s("input",{inert:"",class:"file-input",type:"file",accept:"image/*",onChange:he,ref_key:"iconInput",ref:W},null,544),i(H,{icon:["fas","image"],size:"2x"})])),e(r)?(n(),d("button",{key:2,type:"button",class:"delete delete-icon-button is-medium",onClick:B(L,["prevent"])})):c("",!0),i(re,Q({ref_key:"OtpDisplayForQuickForm",ref:P},e(o).data(),{onIncrementHotp:ge,onValidationError:ye,onPleaseCloseMe:l[2]||(l[2]=a=>x.value=!1)}),null,16)])]),s("div",uo,[e(o).errors.any()?(n(),d("div",fo,[(n(!0),d(ce,null,$e(e(o).errors.errors,(a,Be)=>(n(),d("p",{key:Be,class:"help is-danger"},[s("ul",null,[(n(!0),d(ce,null,$e(a,(Ne,qe)=>(n(),d("li",{key:qe},b(Ne),1))),128))])]))),128))])):c("",!0)]),s("div",po,[s("div",mo,[s("div",vo,[s("div",ho,[i(ee,{isLoading:e(o).isBusy},{default:V(()=>[ie(b(t.$t("commons.save")),1)]),_:1},8,["isLoading"])]),i(we,{action:"cancel",isText:!0,isRounded:!1,useLinkTag:!1,onCanceled:ve})])])])])],32)):c("",!0),e(q)?(n(),g(Oe,{key:2,title:t.$t(e(_)?"twofaccounts.forms.edit_account":"twofaccounts.forms.new_account")},{default:V(()=>[s("form",{onSubmit:B(Te,["prevent"]),onKeydown:l[15]||(l[15]=a=>e(o).onKeydown(a))},[e(_)?c("",!0):(n(),d("div",go,[s("div",yo,[s("div",{role:"button",tabindex:"0",class:C(["file is-small",{"is-black":K=="dark"}]),onKeyup:l[4]||(l[4]=Ie(a=>e(ue).click(),["enter"]))},[s("label",{class:"file-label",title:t.$t("twofaccounts.forms.use_qrcode.title"),ref_key:"qrcodeInputLabel",ref:ue},[s("input",{inert:"",tabindex:"-1",class:"file-input",type:"file",accept:"image/*",onChange:Me,ref_key:"qrcodeInput",ref:de},null,544),s("span",bo,[s("span",wo,[i(H,{icon:["fas","qrcode"],size:"lg"})]),s("span",ko,b(t.$t("twofaccounts.forms.prefill_using_qrcode")),1)])],8,_o)],34)])])),e(T).errors.hasAny("qrcode")?(n(),g(X,{key:1,error:e(T).errors.get("qrcode"),field:"qrcode",class:"help-for-file"},null,8,["error"])):c("",!0),i(oe,{modelValue:e(o).service,"onUpdate:modelValue":l[5]||(l[5]=a=>e(o).service=a),fieldName:"service",fieldError:e(o).errors.get("email"),isDisabled:e(o).otp_type==="steamtotp",label:"twofaccounts.service",placeholder:t.$t("twofaccounts.forms.service.placeholder"),autofocus:""},null,8,["modelValue","fieldError","isDisabled","placeholder"]),i(oe,{modelValue:e(o).account,"onUpdate:modelValue":l[6]||(l[6]=a=>e(o).account=a),fieldName:"account",fieldError:e(o).errors.get("account"),label:"twofaccounts.account",placeholder:t.$t("twofaccounts.forms.account.placeholder")},null,8,["modelValue","fieldError","placeholder"]),s("label",Vo,b(t.$t("twofaccounts.icon")),1),s("div",Eo,[e(w).preferences.getOfficialIcons?(n(),d("div",$o,[i(ee,{onClick:_e,color:K=="dark"?"is-dark":"",nativeType:"button","is-loading":e(j),isDisabled:!e(o).service,"aria-describedby":"lgdTryMyLuck"},{default:V(()=>[s("span",Io,[i(H,{icon:["fas","globe"]})]),s("span",null,b(t.$t("twofaccounts.forms.i_m_lucky")),1)]),_:2},1032,["color","is-loading","isDisabled"])])):c("",!0),s("div",Fo,[s("div",{role:"button",tabindex:"0",class:C(["file mr-3",K=="dark"?"is-dark":"is-white"]),onKeyup:l[7]||(l[7]=Ie(a=>e(fe).click(),["enter"]))},[s("label",{for:"filUploadIcon",class:"file-label",ref_key:"iconInputLabel",ref:fe},[s("input",{id:"filUploadIcon",tabindex:"-1",class:"file-input",type:"file",accept:"image/*",onChange:he,ref_key:"iconInput",ref:W},null,544),s("span",Co,[s("span",To,[i(H,{icon:["fas","upload"]})]),s("span",So,b(t.$t("twofaccounts.forms.choose_image")),1)])],512)],34),e(r)?(n(),d("span",{key:0,class:C(["tag is-large",K=="dark"?"is-dark":"is-white"])},[s("img",{class:"icon-preview",src:e(R).config.subdirectory+"/storage/icons/"+e(r),alt:t.$t("twofaccounts.icon_to_illustrate_the_account")},null,8,xo),s("button",{type:"button",class:"clear-selection delete is-small",onClick:B(L,["prevent"]),"aria-label":t.$t("twofaccounts.remove_icon")},null,8,Lo)],2)):c("",!0)])]),s("div",Mo,[e($).errors.hasAny("icon")?(n(),g(X,{key:0,error:e($).errors.get("icon"),field:"icon",class:"help-for-file"},null,8,["error"])):c("",!0),e(w).preferences.getOfficialIcons?(n(),d("p",{key:1,id:"lgdTryMyLuck",class:"help",innerHTML:t.$t("twofaccounts.forms.i_m_lucky_legend")},null,8,Ao)):c("",!0)]),e(pe).length>0?(n(),g(Ae,{key:2,modelValue:e(o).group_id,"onUpdate:modelValue":l[8]||(l[8]=a=>e(o).group_id=a),options:e(pe),fieldName:"group_id",label:"twofaccounts.forms.group.label",help:"twofaccounts.forms.group.help"},null,8,["modelValue","options"])):c("",!0),i(te,{modelValue:e(o).otp_type,"onUpdate:modelValue":l[9]||(l[9]=a=>e(o).otp_type=a),isDisabled:e(_),choices:z,fieldName:"otp_type",fieldError:e(o).errors.get("otp_type"),label:"twofaccounts.forms.otp_type.label",help:"twofaccounts.forms.otp_type.help",hasOffset:!0},null,8,["modelValue","isDisabled","fieldError"]),e(o).otp_type!=""?(n(),d("div",Uo,[i(Fe,{isEditMode:e(_),modelValue:e(o).secret,"onUpdate:modelValue":l[10]||(l[10]=a=>e(o).secret=a),modelModifiers:{trimAll:!0},fieldName:"secret",fieldError:e(o).errors.get("secret"),label:"twofaccounts.forms.secret.label",help:"twofaccounts.forms.secret.help"},null,8,["isEditMode","modelValue","fieldError"]),e(o).otp_type!=="steamtotp"?(n(),d("div",Oo,[s("h2",Bo,b(t.$t("commons.options")),1),s("p",No,b(t.$t("twofaccounts.forms.options_help")),1),i(te,{modelValue:e(o).digits,"onUpdate:modelValue":l[11]||(l[11]=a=>e(o).digits=a),choices:m,fieldName:"digits",fieldError:e(o).errors.get("digits"),label:"twofaccounts.forms.digits.label",help:"twofaccounts.forms.digits.help"},null,8,["modelValue","fieldError"]),i(te,{modelValue:e(o).algorithm,"onUpdate:modelValue":l[12]||(l[12]=a=>e(o).algorithm=a),choices:v,fieldName:"algorithm",fieldError:e(o).errors.get("algorithm"),label:"twofaccounts.forms.algorithm.label",help:"twofaccounts.forms.algorithm.help"},null,8,["modelValue","fieldError"]),e(o).otp_type==="totp"?(n(),g(oe,{key:0,pattern:"[0-9]{1,4}",class:C("is-third-width-field"),modelValue:e(o).period,"onUpdate:modelValue":l[13]||(l[13]=a=>e(o).period=a),fieldName:"period",fieldError:e(o).errors.get("period"),label:"twofaccounts.forms.period.label",help:"twofaccounts.forms.period.help",placeholder:t.$t("twofaccounts.forms.period.placeholder")},null,8,["modelValue","fieldError","placeholder"])):c("",!0),e(o).otp_type==="hotp"?(n(),g(Fe,{key:1,pattern:"[0-9]{1,4}",isEditMode:e(_),isExpanded:!1,modelValue:e(o).counter,"onUpdate:modelValue":l[14]||(l[14]=a=>e(o).counter=a),fieldName:"counter",fieldError:e(o).errors.get("counter"),label:"twofaccounts.forms.counter.label",placeholder:t.$t("twofaccounts.forms.counter.placeholder"),help:e(_)?"twofaccounts.forms.counter.help_lock":"twofaccounts.forms.counter.help"},null,8,["isEditMode","modelValue","fieldError","placeholder","help"])):c("",!0)])):c("",!0)])):c("",!0),i(Ue,{showButtons:!0},{default:V(()=>[s("p",qo,[i(ee,{id:e(_)?"btnUpdate":"btnCreate",isLoading:e(o).isBusy,class:"is-rounded"},{default:V(()=>[ie(b(e(_)?t.$t("commons.save"):t.$t("commons.create")),1)]),_:1},8,["id","isLoading"])]),e(o).otp_type&&e(o).secret?(n(),d("p",Do,[s("button",{id:"btnPreview",type:"button",class:"button is-success is-rounded",onClick:xe},b(t.$t("twofaccounts.forms.test")),1)])):c("",!0),i(we,{action:"cancel",useLinkTag:!1,onCanceled:ve})]),_:1})],32),i(ke,{modelValue:e(x),"onUpdate:modelValue":l[17]||(l[17]=a=>ae(x)?x.value=a:null)},{default:V(()=>[i(re,Q({ref_key:"OtpDisplayForAdvancedForm",ref:Y},e(o).data(),{onIncrementHotp:ge,onValidationError:ye,onPleaseCloseMe:l[16]||(l[16]=a=>x.value=!1)}),null,16)]),_:1},8,["modelValue"])]),_:2},1032,["title"])):c("",!0),i(ke,{modelValue:e(F),"onUpdate:modelValue":l[18]||(l[18]=a=>ae(F)?F.value=a:null)},{default:V(()=>[i(We,{qrContent:e(k)},null,8,["qrContent"])]),_:1},8,["modelValue"])])]),_:1})}}};export{zo as default};
