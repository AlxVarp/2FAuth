import{P as N,u as O,a as T,b as D,Q as C,a2 as M,d as j,r as G,e as _,f as a,g as u,i as t,k as L,p as f,m as n,F as H,h as l,t as o,D as B,j as r,w as I,l as d,I as k}from"./app-1b332c21.js";import{F as P}from"./Form-940b5f6c.js";import{w as U}from"./webauthnService-839b1903.js";/*! 2FAuth version 5.0.0 - Copyright (c) 2023 Bubka - https://github.com/Bubka/2FAuth */const q={class:"field"},Q=["onSubmit"],z={class:"nav-links"},J={key:0},X=["onKeyup"],Y={key:1,class:"mt-4"},Z={key:2,class:"columns mt-4 is-variable is-1"},x={class:"column is-narrow py-1"},ee={class:"column py-1"},te={key:0,id:"lnkSignWithOpenID",class:"button is-link is-outlined is-small ml-2",href:"/socialite/redirect/openid"},se={key:1,id:"lnkSignWithGithub",class:"button is-link is-outlined is-small ml-2",href:"/socialite/redirect/github"},ie=["innerHTML"],oe=["innerHTML"],ae=["onSubmit"],ne={class:"nav-links"},le=["onKeyup","aria-label"],re={key:0,class:"mt-4"},ue={key:1,class:"columns mt-4 is-variable is-1"},de={class:"column is-narrow py-1"},ce={class:"column py-1"},me={key:0,id:"lnkSignWithOpenID",class:"button is-link is-outlined is-small mr-2",href:"/socialite/redirect/openid"},he={key:1,id:"lnkSignWithGithub",class:"button is-link is-outlined is-small mr-2",href:"/socialite/redirect/github"},be={__name:"Login",setup(_e){const c=N("2fauth"),S=O(),p=T(),h=D(),g=C(),v=p.preferences.useWebauthnOnly?!0:M(c.prefix+"showWebauthnForm",!1),i=j(new P({email:"",password:""})),F=G(!1);function b(){i.clear(),v.value=!v.value}function A(e){h.clear(),i.post("/user/login",{returnError:!0}).then(async s=>{await p.loginAs({name:s.data.name,email:s.data.email,oauth_provider:s.data.oauth_provider,preferences:s.data.preferences,isAdmin:s.data.is_admin}),S.push({name:"accounts"})}).catch(s=>{s.response.status===401?h.alert({text:k("auth.forms.authentication_failed"),duration:1e4}):s.response.status!==422&&h.error(s)})}function E(){h.clear(),i.clear(),F.value=!0,U.authenticate(i.email).then(async e=>{await p.loginAs({name:e.data.name,email:e.data.email,oauth_provider:e.data.oauth_provider,preferences:e.data.preferences,isAdmin:e.data.is_admin}),S.push({name:"accounts"})}).catch(e=>{"webauthn"in e?e.name=="is-warning"?h.warn({text:k(e.message)}):h.alert({text:k(e.message)}):e.response.status===401?h.alert({text:k("auth.forms.authentication_failed"),duration:1e4}):e.response.status==422?i.errors.set(i.extractErrors(e.response)):h.error(e)}).finally(()=>{F.value=!1})}return(e,s)=>{const $=_("FormField"),V=_("FormButtons"),y=_("RouterLink"),w=_("FontAwesomeIcon"),W=_("FormWrapper"),K=_("FormPasswordField"),R=_("VueFooter");return a(),u(H,null,[t(v)?(a(),L(W,{key:0,title:"auth.forms.webauthn_login",punchline:"auth.welcome_to_2fauth"},{default:f(()=>[l("div",q,o(e.$t("auth.webauthn.use_security_device_to_sign_in")),1),l("form",{id:"frmWebauthnLogin",onSubmit:B(E,["prevent"]),onKeydown:s[1]||(s[1]=m=>t(i).onKeydown(m))},[n($,{modelValue:t(i).email,"onUpdate:modelValue":s[0]||(s[0]=m=>t(i).email=m),fieldName:"email",fieldError:t(i).errors.get("email"),inputType:"email",label:"auth.forms.email",autofocus:""},null,8,["modelValue","fieldError"]),n(V,{isBusy:t(F),caption:"commons.continue",submitId:"btnContinue"},null,8,["isBusy"])],40,Q),l("div",z,[l("p",null,[r(o(e.$t("auth.webauthn.lost_your_device"))+"  ",1),n(y,{id:"lnkRecoverAccount",to:{name:"webauthn.lost"},class:"is-link"},{default:f(()=>[r(o(e.$t("auth.webauthn.recover_your_account")),1)]),_:1},8,["to"])]),t(p).preferences.useWebauthnOnly?d("",!0):(a(),u("p",J,[r(o(e.$t("auth.sign_in_using"))+"  ",1),l("a",{id:"lnkSignWithLegacy",role:"button",class:"is-link",onKeyup:I(b,["enter"]),onClick:b,tabindex:"0"},o(e.$t("auth.login_and_password")),41,X)])),t(g).disableRegistration==!1?(a(),u("p",Y,[r(o(e.$t("auth.forms.dont_have_account_yet"))+"  ",1),n(y,{id:"lnkRegister",to:{name:"register"},class:"is-link"},{default:f(()=>[r(o(e.$t("auth.register")),1)]),_:1})])):d("",!0),t(g).enableSso&&Object.values(t(c).config.sso).includes(!0)?(a(),u("div",Z,[l("div",x,o(e.$t("auth.or_continue_with")),1),l("div",ee,[t(c).config.sso.openid?(a(),u("a",te,[r(" OpenID"),n(w,{class:"ml-2",icon:["fab","openid"]})])):d("",!0),t(c).config.sso.github?(a(),u("a",se,[r(" Github"),n(w,{class:"ml-2",icon:["fab","github-alt"]})])):d("",!0)])])):d("",!0)])]),_:1})):(a(),L(W,{key:1,title:"auth.forms.login",punchline:"auth.welcome_to_2fauth"},{default:f(()=>[t(c).isDemoApp?(a(),u("div",{key:0,class:"notification is-info has-text-centered is-radiusless",innerHTML:e.$t("auth.forms.welcome_to_demo_app_use_those_credentials")},null,8,ie)):d("",!0),t(c).isTestingApp?(a(),u("div",{key:1,class:"notification is-warning has-text-centered is-radiusless",innerHTML:e.$t("auth.forms.welcome_to_testing_app_use_those_credentials")},null,8,oe)):d("",!0),l("form",{id:"frmLegacyLogin",onSubmit:B(A,["prevent"]),onKeydown:s[4]||(s[4]=m=>t(i).onKeydown(m))},[n($,{modelValue:t(i).email,"onUpdate:modelValue":s[2]||(s[2]=m=>t(i).email=m),fieldName:"email",fieldError:t(i).errors.get("email"),inputType:"email",label:"auth.forms.email",autofocus:""},null,8,["modelValue","fieldError"]),n(K,{modelValue:t(i).password,"onUpdate:modelValue":s[3]||(s[3]=m=>t(i).password=m),fieldName:"password",fieldError:t(i).errors.get("password"),label:"auth.forms.password"},null,8,["modelValue","fieldError"]),n(V,{isBusy:t(i).isBusy,caption:"auth.sign_in",submitId:"btnSignIn"},null,8,["isBusy"])],40,ae),l("div",ne,[l("p",null,[r(o(e.$t("auth.forms.forgot_your_password"))+"  ",1),n(y,{id:"lnkResetPwd",to:{name:"password.request"},class:"is-link","aria-label":e.$t("auth.forms.reset_your_password")},{default:f(()=>[r(o(e.$t("auth.forms.request_password_reset")),1)]),_:1},8,["to","aria-label"])]),l("p",null,[r(o(e.$t("auth.sign_in_using"))+"  ",1),l("a",{id:"lnkSignWithWebauthn",role:"button",class:"is-link",onKeyup:I(b,["enter"]),onClick:b,tabindex:"0","aria-label":e.$t("auth.sign_in_using_security_device")},o(e.$t("auth.webauthn.security_device")),41,le)]),t(g).disableRegistration==!1?(a(),u("p",re,[r(o(e.$t("auth.forms.dont_have_account_yet"))+"  ",1),n(y,{id:"lnkRegister",to:{name:"register"},class:"is-link"},{default:f(()=>[r(o(e.$t("auth.register")),1)]),_:1})])):d("",!0),t(g).enableSso&&Object.values(t(c).config.sso).includes(!0)?(a(),u("div",ue,[l("div",de,o(e.$t("auth.or_continue_with")),1),l("div",ce,[t(c).config.sso.openid?(a(),u("a",me,[r(" OpenID"),n(w,{class:"ml-2",icon:["fab","openid"]})])):d("",!0),t(c).config.sso.github?(a(),u("a",he,[r(" Github"),n(w,{class:"ml-2",icon:["fab","github-alt"]})])):d("",!0)])])):d("",!0)])]),_:1})),n(R)],64)}}};export{be as default};
