import{a as D,u as G,a1 as R,S as q,r as v,x as J,o as Q,c as X,I as x,a0 as Y,d as r,j as a,e as o,k as _,f as s,i as d,L as Z,l as m,m as i,t as n,w as ee,g,F as se,E as te,h as oe,U as ne,n as A,C as z,H as y}from"./app-BActpDYy.js";import{F as ae}from"./Form-BYep5rsU.js";import{_ as ie}from"./SettingTabs-B4kZoN0b.js";import{S as le}from"./Spinner-_7x7eChA.js";/*! 2FAuth version 5.4.0 - Copyright (c) 2024 Bubka - https://github.com/Bubka/2FAuth */const re={class:"options-tabs"},ce={key:0,class:"notification is-warning has-text-centered"},ue=["innerHTML"],de={class:"title is-4 has-text-grey-light"},_e={class:"is-size-7-mobile"},me={class:"mt-3"},pe={key:2},ve={class:"tags is-pulled-right"},fe=["onClick"],he=["onClick","title"],ke={key:1,class:"is-size-7-mobile is-size-6 my-3"},ge={key:2,class:"pat is-family-monospace is-size-6 is-size-7-mobile has-text-success"},ye={class:"mt-2 is-size-7 is-pulled-right"},be={key:0,class:"is-overlay modal-otp modal-background"},Te={class:"main-section"},Ce={class:"field is-grouped"},we={class:"control"},Fe={class:"control"},Ae={__name:"OAuth",setup($e){const E=Z("2fauth"),p=D(),b=G(),L=R(E.prefix+"returnTo","accounts"),{copy:M}=q({legacy:!0}),c=v([]),T=v(!1),f=v(!1),h=v(null),C=v(null),w=J(()=>appSettings.enableSso&&appSettings.useSsoOnly||b.authenticated_by_proxy);Q(()=>{F()});const u=X(new ae({name:""}));function F(){T.value=!0,x.getPersonalAccessTokens({returnError:!0}).then(e=>{c.value=[],e.data.forEach(l=>{l.id===C.value?(l.value=h.value,c.value.unshift(l)):c.value.push(l)})}).catch(e=>{e.response.status===405||p.error(e)}).finally(()=>{T.value=!1,C.value=null,h.value=null})}function $(){I(),w.value?p.warn({text:y("errors.unsupported_with_reverseproxy")}):f.value=!0}function N(){u.post("/oauth/personal-access-tokens").then(e=>{h.value=e.data.accessToken,C.value=e.data.token.id,F(),f.value=!1,u.reset()})}function P(e){confirm(y("settings.confirm.revoke"))&&x.deletePersonalAccessToken(e).then(l=>{c.value=c.value.filter(k=>k.id!==e),p.success({text:y("settings.token_revoked")})})}function I(){c.value.forEach(e=>{e.value=null}),h.value=null}function K(e){M(e),p.success({text:y("commons.copied_to_clipboard")})}function U(){f.value=!1,u.reset()}return Y(e=>{e.name.startsWith("settings.")||p.clear()}),(e,l)=>{const k=m("FontAwesomeIcon"),H=m("ButtonBackCloseCancel"),O=m("VueFooter"),V=m("FormWrapper"),W=m("FormField"),B=m("VueButton");return i(),r("div",null,[a(ie,{activeTab:"settings.oauth.tokens"},null,8,["activeTab"]),o("div",re,[a(V,null,{default:_(()=>[s(w)&&s(b).oauth_provider?(i(),r("div",ce,n(e.$t("auth.sso_only_x_settings_are_disabled",{auth_method:"OAuth"})),1)):d("",!0),s(w)&&s(b).authenticated_by_proxy?(i(),r("div",{key:1,class:"notification is-warning has-text-centered",innerHTML:e.$t("auth.auth_handled_by_proxy")},null,8,ue)):d("",!0),o("h4",de,n(e.$t("settings.personal_access_tokens")),1),o("div",_e,n(e.$t("settings.token_legend")),1),o("div",me,[o("a",{tabindex:"0",class:"is-link",onClick:$,onKeyup:ee($,["enter"])},[a(k,{icon:["fas","plus-circle"]}),g(" "+n(e.$t("settings.generate_new_token")),1)],32)]),s(c).length>0?(i(),r("div",pe,[(i(!0),r(se,null,te(s(c),t=>(i(),r("div",{key:t.id,class:"group-item is-size-5 is-size-6-mobile"},[t.value?(i(),oe(k,{key:0,class:"has-text-success",icon:["fas","check"]})):d("",!0),g(" "+n(t.name)+" ",1),o("div",ve,[a(s(ne),null,{default:_(({mode:S})=>[t.value?(i(),r("button",{key:0,class:A(["button tag",{"is-link":S!="dark"}]),onClick:z(j=>K(t.value),["stop"])},n(e.$t("commons.copy")),11,fe)):d("",!0),o("button",{class:A(["button tag",S==="dark"?"is-dark":"is-white"]),onClick:j=>P(t.id),title:e.$t("settings.revoke")},n(e.$t("settings.revoke")),11,he)]),_:2},1024)]),t.value?(i(),r("span",ke,n(e.$t("settings.make_sure_copy_token")),1)):d("",!0),t.value?(i(),r("span",ge,n(t.value),1)):d("",!0)]))),128)),o("div",ye,n(e.$t("settings.revoking_a_token_is_permanent")),1)])):d("",!0),a(le,{isVisible:s(T)&&s(c).length===0},null,8,["isVisible"]),a(O,{showButtons:!0},{default:_(()=>[a(H,{returnTo:{name:s(L)},action:"close"},null,8,["returnTo"])]),_:1})]),_:1})]),s(f)?(i(),r("div",be,[o("main",Te,[a(V,{title:"settings.forms.new_token"},{default:_(()=>[o("form",{onSubmit:z(N,["prevent"]),onKeydown:l[1]||(l[1]=t=>s(u).onKeydown(t))},[a(W,{modelValue:s(u).name,"onUpdate:modelValue":l[0]||(l[0]=t=>s(u).name=t),fieldName:"name",fieldError:s(u).errors.get("name"),inputType:"text",label:"commons.name",autofocus:""},null,8,["modelValue","fieldError"]),o("div",Ce,[o("div",we,[a(B,{id:"btnGenerateToken",isLoading:s(u).isBusy},{default:_(()=>[g(n(e.$t("commons.generate")),1)]),_:1},8,["isLoading"])]),o("div",Fe,[a(B,{onClick:U,nativeType:"button",id:"btnCancel",color:"is-text"},{default:_(()=>[g(n(e.$t("commons.cancel")),1)]),_:1})])])],32)]),_:1})])])):d("",!0)])}}};export{Ae as default};
