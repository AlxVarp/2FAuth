import{r,v as C,o as R,s as Z,f as u,g as d,F as ee,G as te,i as n,n as N,a as oe,b as ae,Q as ne,S as se,_ as re,x as le,e as ue,h as x,l as A,m as G,p as ie,t as b,w as ce,Y as pe,U as ve,A as j,B as q,k as M,D as fe,K as D,I as z,P as Q}from"./app-94c6def1.js";import{S as de}from"./Spinner-f03b508f.js";/*! 2FAuth version 5.1.0 - Copyright (c) 2023 Bubka - https://github.com/Bubka/2FAuth */const ye={__name:"TotpLooper",props:{step_count:{type:Number,default:10},period:Number,generated_at:Number,autostart:{type:Boolean,default:!0}},emits:["loop-started","loop-ended","stepped-up"],setup(k,{expose:T,emit:l}){const o=k,s=r(null),i=r(null),S=r(null),y=r(null),c=r(null),p=C(()=>s.value%o.period),h=C(()=>o.period-p.value),w=C(()=>o.period/o.step_count),e=C(()=>{let v=p.value*o.step_count/o.period;return Math.floor(v)+0}),m=(v=null)=>{_(),s.value=v??o.generated_at,l("loop-started",e.value),c.value=e.value,i.value=setTimeout(function(){_(),l("loop-ended")},h.value*1e3);let g=Math.ceil(p.value/w.value)*w.value-p.value;S.value=setTimeout(function(){g>0&&(c.value+=1,l("stepped-up",c.value)),y.value=setInterval(function(){c.value+=1,l("stepped-up",c.value)},w.value*1e3)},g*1e3)},_=()=>{clearTimeout(i.value),clearTimeout(S.value),clearInterval(y.value),c.value=s.value=null};return R(()=>{o.autostart==!0&&m()}),Z(()=>{_()}),T({startLoop:m,clearLooper:_,props:o}),(v,g)=>(u(),d("div"))}},me=["data-is-active"],_e={__name:"Dots",props:{stepCount:{type:Number,default:10},initialIndex:{type:Number,default:null},period:{type:Number,default:null}},setup(k,{expose:T}){const l=k,o=r(0),s=C(()=>o.value==-1);function i(y){o.value=y<l.stepCount?y+1:1}function S(){o.value=-1}return R(()=>{isNaN(l.initialIndex)||i(l.initialIndex)}),T({turnOn:i,turnOff:S,props:l}),(y,c)=>(u(),d("ul",{class:N(["dots",{off:n(s)}])},[(u(!0),d(ee,null,te(k.stepCount,p=>(u(),d("li",{key:p,"data-is-active":p==n(o)?!0:null},null,8,me))),128))],2))}},ge=["src","alt"],he=["title"],we={key:1,tabindex:"0",class:"otp is-size-1"},ke={key:0,class:"mt-3"},xe={__name:"OtpDisplay",props:{otp_type:String,account:String,service:String,icon:String,secret:String,digits:Number,algorithm:String,period:null,counter:null,image:String,qrcode:null,uri:String},emits:["please-close-me","increment-hotp","validation-error"],setup(k,{expose:T,emit:l}){const o=k,s=oe(),i=ae(),S=ne("2fauth"),{copy:y,copied:c}=se({legacy:!0}),p=re(),h=r(null),w=r(null),e=r({otp_type:"",account:"",service:"",icon:"",secret:"",digits:null,algorithm:"",period:null,counter:null,image:""}),m=r(""),_=r(null),v=r(!1),g=r(!1),O=r(!1),B=r(),I=r(),E=r();le(()=>o.icon,a=>{a!=null&&(e.value.icon=a)});const Y=async a=>{if(O.value=!1,e.value.otp_type=o.otp_type,e.value.account=o.account,e.value.service=o.service,e.value.icon=o.icon,e.value.secret=o.secret,e.value.digits=o.digits,e.value.algorithm=o.algorithm,e.value.period=o.period,e.value.counter=o.counter,F(),a){h.value=a;const{data:t}=await D.get(h.value);e.value.service=t.service,e.value.account=t.account,e.value.icon=t.icon,e.value.otp_type=t.otp_type,P(t.otp_type)&&t.counter&&(e.value.counter=t.counter)}else o.uri?(w.value=o.uri,e.value.otp_type=o.uri.slice(0,15).toLowerCase()==="otpauth://totp/"?"totp":"hotp"):o.secret?!U(e.value.otp_type)&&!P(e.value.otp_type)&&i.error(new Error(z("errors.not_a_supported_otp_type"))):i.error(new Error(z("errors.cannot_create_otp_without_secret")));try{await V(),W()}catch{L()}};async function V(){F(),await J().then(a=>{let t=a.data;m.value=t.password,s.preferences.copyOtpOnDisplay&&$(t.password),U(t.otp_type)?(_.value=t.generated_at,e.value.period=t.period,v.value=!0,Q().then(()=>{I.value.startLoop()})):P(t.otp_type)&&(e.value.counter=t.counter,l("increment-hotp",{nextHotpCounter:t.counter,nextUri:t.uri}))}).catch(a=>{a.response.status===422&&l("validation-error",a.response)}).finally(()=>{g.value=!1})}function F(){g.value=!0,B.value.turnOff()}function J(){return h.value?D.getOtpById(h.value):w.value?D.getOtpByUri(w.value):D.getOtpByParams(e.value)}function L(){var a;h.value=e.value.counter=_.value=null,e.value.service=e.value.account=e.value.icon=e.value.otp_type=e.value.secret="",m.value="... ...",v.value=!1,(a=I.value)==null||a.clearLooper()}function W(){Q().then(()=>{var a;(a=E.value)==null||a.focus()})}function $(a,t){y(a.replace(/ /g,"")),c&&(s.preferences.kickUserAfter==-1&&(t||!1)===!0&&p.name!="importAccounts"?s.logout({kicked:!0}):s.preferences.closeOtpOnCopy&&(t||!1)===!0&&(l("please-close-me"),O.value=!1,L()),s.preferences.clearSearchOnCopy&&l("please-clear-search"),s.preferences.viewDefaultGroupOnCopy&&(s.preferences.activeGroup=s.preferences.defaultGroup==-1?s.preferences.activeGroup:s.preferences.defaultGroup),i.success({text:z("commons.copied_to_clipboard")}))}function U(a){return a==="totp"||a==="steamtotp"}function P(a){return a==="hotp"}function K(a){B.value.turnOn(a)}return T({show:Y,clearOTP:L}),(a,t)=>{const H=ue("font-awesome-icon");return u(),d("div",null,[x("figure",{class:N(["image is-64x64",{"no-icon":!n(e).icon}]),style:{display:"inline-block"}},[n(e).icon?(u(),d("img",{key:0,src:n(S).config.subdirectory+"/storage/icons/"+n(e).icon,alt:a.$t("twofaccounts.icon_to_illustrate_the_account")},null,8,ge)):A("",!0)],2),G(n(ve),null,{default:ie(({mode:f})=>[x("p",{class:N(["is-size-4 has-ellipsis",f=="dark"?"has-text-grey-light":"has-text-grey"])},b(n(e).service),3),x("p",{class:N(["is-size-6 has-ellipsis",f=="dark"?"has-text-grey":"has-text-grey-light"])},b(n(e).account),3),x("p",null,[n(g)?(u(),d("span",we,[G(de,{isVisible:n(g),type:"raw"},null,8,["isVisible"])])):(u(),d("span",{key:0,id:"otp",role:"log",ref_key:"otpSpanTag",ref:E,tabindex:"0",class:N(["otp is-size-1 is-clickable px-3",f=="dark"?"has-text-white":"has-text-grey-dark"]),onClick:t[0]||(t[0]=X=>$(n(m),!0)),onKeyup:t[1]||(t[1]=ce(X=>$(n(m),!0),["enter"])),title:a.$t("commons.copy_to_clipboard")},b(n(pe)(n(m),n(s).preferences.showOtpAsDot&&n(s).preferences.revealDottedOTP&&n(O))),43,he))])]),_:1}),j(G(_e,{ref_key:"dots",ref:B},null,512),[[q,U(n(e).otp_type)]]),j(x("p",null,b(a.$t("twofaccounts.forms.counter.label"))+": "+b(n(e).counter),513),[[q,P(n(e).otp_type)]]),n(s).preferences.showOtpAsDot&&n(s).preferences.revealDottedOTP?(u(),d("p",ke,[x("button",{class:"button is-ghost has-text-grey-dark",onClick:t[2]||(t[2]=fe(f=>O.value=!n(O),["stop"]))},[n(O)?(u(),M(H,{key:0,icon:["fas","eye"]})):(u(),M(H,{key:1,icon:["fas","eye-slash"]}))])])):A("",!0),n(v)?(u(),M(ye,{key:1,period:n(e).period,generated_at:n(_),autostart:!1,onLoopEnded:t[3]||(t[3]=f=>V()),onLoopStarted:t[4]||(t[4]=f=>K(f)),onSteppedUp:t[5]||(t[5]=f=>K(f)),ref_key:"totpLooper",ref:I},null,8,["period","generated_at"])):A("",!0)])}}};export{xe as _,ye as a,_e as b};
